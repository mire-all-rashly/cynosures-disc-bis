FROM debian:testing-slim

ARG START_POINT=/app

RUN  apt update \
  && apt install -y openssl python gcc python-dev \
  && useradd -m -s /bin/bash -p `echo -n 'test' | openssl passwd -6 -stdin` test \
  && rm -rf /var/lib/apt/lists/*

COPY data/sources.list /etc/apt/
COPY data/cve-2019-18634 /etc/sudoers.d/

RUN  apt update \
  && apt install -y sudo python-pip \
  && python -m pip install pwn \
  && rm -rf /var/lib/apt/lists/*

COPY data $START_POINT
WORKDIR $START_POINT

USER test
ENTRYPOINT ["/bin/bash", "/app/run.sh"]
CMD ["run"]
